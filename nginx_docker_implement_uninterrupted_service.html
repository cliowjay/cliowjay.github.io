<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº’å‹•å¼é›¶åœæ©Ÿéƒ¨ç½²è§£æ±ºæ–¹æ¡ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutral Harmony -->
    <!-- Application Structure Plan: The SPA is designed with a clear, task-oriented flow. It starts by defining the user's current problem, then presents solutions in a tabbed interface. This structure allows the user to easily compare 'Blue-Green Deployment' and 'Rolling Update' side-by-side. Each tab contains a conceptual explanation with diagrams, pros/cons, and ready-to-use code, facilitating direct implementation. The final "Recommendations" section uses a summary chart and table to help the user make an informed decision based on their specific needs (cost, complexity, risk). This structure was chosen for its clarity and direct path from problem to actionable solution. -->
    <!-- Visualization & Content Choices: 
        - Problem Visualization (HTML/CSS): Report Info -> Current downtime issue -> Goal: Visualize the service interruption -> Viz: Simple animated diagram showing a server going down before the new one comes up -> Justification: Immediately clarifies the core problem for the user.
        - Solution Flow Diagrams (HTML/CSS/JS): Report Info -> Deployment strategies (Blue-Green, Rolling) -> Goal: Explain complex flows intuitively -> Viz: Animated diagrams showing traffic switching (Blue-Green) and gradual instance replacement (Rolling) -> Justification: Makes abstract deployment concepts tangible and easy to grasp without complex text.
        - Strategy Comparison Chart (Chart.js Radar): Report Info -> Need to compare solutions -> Goal: Provide a quick, multi-dimensional comparison -> Viz: Radar chart comparing solutions on axes like Cost, Complexity, and Rollback Speed -> Justification: Offers a high-density visual summary that is much faster to parse than a text-based comparison.
        - Interactive Tabs (JS): Report Info -> Multiple solutions to present -> Goal: Organize content cleanly -> Viz: Clickable tabs -> Justification: Standard UI pattern for non-linear exploration and comparison of distinct options.
        All visualizations are built to be interactive and informative, directly supporting the application's goal of enabling the user to understand and implement a zero-downtime solution. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #F8F7F6;
            color: #333;
        }
        .tab-btn {
            transition: all 0.3s ease;
            border-bottom: 4px solid transparent;
        }
        .tab-btn.active {
            color: #2563EB;
            border-bottom-color: #2563EB;
        }
        .content-panel {
            display: none;
        }
        .content-panel.active {
            display: block;
        }
        .pro-con-list {
            padding-left: 1.5rem;
        }
        .pro-con-list li::before {
            position: absolute;
            left: 0;
            font-weight: 700;
            top: 0.1em; /* Adjusted for better vertical alignment */
        }
        .pro-list li::before {
            content: 'âœ“';
            color: #16A34A;
        }
        .con-list li::before {
            content: 'âœ—';
            color: #DC2626;
        }
        pre {
            background-color: #1E293B;
            color: #F8FAFC;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            position: relative;
        }
        .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #475569;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .copy-btn:hover {
            background-color: #64748B;
        }
        .diagram-box {
            border: 2px solid #E5E7EB;
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
            font-weight: 500;
            transition: all 0.5s ease;
            min-height: 80px;
        }
        .server-blue { background-color: #BFDBFE; border-color: #3B82F6; }
        .server-green { background-color: #A7F3D0; border-color: #10B981; }
        .server-old { background-color: #FECACA; border-color: #EF4444; }
        .server-new { background-color: #A7F3D0; border-color: #10B981; }
        .traffic-arrow {
            font-size: 2rem;
            line-height: 1;
            transition: transform 0.5s ease;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 md:p-8 max-w-6xl">
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">å¯¦ç¾é›¶åœæ©Ÿéƒ¨ç½² (Zero-Downtime Deployment)</h1>
            <p class="text-lg text-gray-600">åˆ†ææ‚¨ç›®å‰çš„ CI/CD æµç¨‹ä¸¦æä¾›å¯è¡Œçš„äº’å‹•è§£æ±ºæ–¹æ¡ˆ</p>
        </header>

        <section id="problem" class="mb-12 bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-bold mb-4 text-gray-800 border-b pb-2">ğŸ“ ç•¶å‰å•é¡Œåˆ†æ</h2>
            <p class="mb-4 text-gray-700">æ‚¨ç›®å‰çš„éƒ¨ç½²æµç¨‹æ˜¯ <code class="bg-gray-200 text-red-600 font-mono p-1 rounded">docker compose down</code> å¾Œå† <code class="bg-gray-200 text-green-700 font-mono p-1 rounded">docker compose up --build</code>ã€‚é€™å°è‡´åœ¨é—œé–‰èˆŠæœå‹™åˆ°å•Ÿå‹•æ–°æœå‹™ä¹‹é–“ï¼Œå­˜åœ¨ä¸€å€‹æ˜é¡¯çš„æœå‹™ä¸­æ–·æœŸï¼Œåš´é‡å½±éŸ¿ä½¿ç”¨è€…é«”é©—ã€‚ä¸‹åœ–æ¨¡æ“¬äº†é€™å€‹éç¨‹ï¼š</p>
            <div class="flex items-center justify-center space-x-4 p-4 bg-gray-50 rounded-lg">
                <div class="text-center">
                    <div id="downtime-server" class="diagram-box server-blue w-32">æœå‹™é‹è¡Œä¸­</div>
                    <div class="mt-2 text-sm font-semibold">v1.0</div>
                </div>
                <div id="downtime-arrow" class="traffic-arrow text-gray-400 text-3xl font-mono relative">---></div>
                <div class="text-center">
                    <div class="diagram-box bg-gray-200 border-gray-400 w-32 flex items-center justify-center">æœå‹™ä¸­æ–·</div>
                    <div class="mt-2 text-sm font-semibold text-red-600">Downtime</div>
                </div>
                <div class="traffic-arrow text-gray-400 text-3xl font-mono relative">---></div>
                <div class="text-center">
                     <div class="diagram-box server-blue w-32">æœå‹™æ¢å¾©</div>
                     <div class="mt-2 text-sm font-semibold">v1.1</div>
                </div>
            </div>
             <p class="text-center mt-2 text-sm text-gray-500">é€™å€‹æµç¨‹ç¢ºä¿äº†ç’°å¢ƒçš„ä¹¾æ·¨ï¼Œä½†ä»£åƒ¹æ˜¯æ•¸åˆ†é˜çš„åœæ©Ÿæ™‚é–“ã€‚</p>
        </section>

        <main>
            <div class="border-b border-gray-300 mb-8">
                <nav class="flex -mb-px space-x-6">
                    <button class="tab-btn active py-4 px-1 text-lg font-medium" data-tab="blue-green">æ–¹æ¡ˆä¸€ï¼šè—ç¶ éƒ¨ç½²</button>
                    <button class="tab-btn py-4 px-1 text-lg font-medium" data-tab="rolling-update">æ–¹æ¡ˆäºŒï¼šæ»¾å‹•æ›´æ–°</button>
                    <button class="tab-btn py-4 px-1 text-lg font-medium" data-tab="recommendations">æ–¹æ¡ˆæ¯”è¼ƒèˆ‡å»ºè­°</button>
                </nav>
            </div>

            <!-- Blue-Green Deployment Panel -->
            <div id="blue-green" class="content-panel active">
                <section class="bg-white p-6 rounded-lg shadow-md mb-8">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">æ¦‚å¿µèªªæ˜</h3>
                    <p class="mb-4 text-gray-700">è—ç¶ éƒ¨ç½²æ˜¯é€éç¶­è­·å…©å¥—å®Œå…¨ç›¸åŒçš„ç”Ÿç”¢ç’°å¢ƒï¼ˆç¨±ç‚ºã€Œè—è‰²ã€å’Œã€Œç¶ è‰²ã€ï¼‰ä¾†å¯¦ç¾é›¶åœæ©Ÿã€‚ä»»ä½•æ™‚å€™åªæœ‰ä¸€å¥—ç’°å¢ƒå°å¤–æä¾›æœå‹™ã€‚éƒ¨ç½²æ–°ç‰ˆæœ¬æ™‚ï¼Œæˆ‘å€‘åœ¨é–’ç½®çš„ç’°å¢ƒä¸Šéƒ¨ç½²ï¼Œæ¸¬è©¦é€šéå¾Œï¼Œåªéœ€åˆ‡æ›åå‘ä»£ç†ï¼ˆå¦‚ Nginxï¼‰çš„æµé‡æŒ‡å‘å³å¯ã€‚å¦‚æœæ–°ç‰ˆå‡ºå•é¡Œï¼Œå¯ä»¥ç§’ç´šåˆ‡æ›å›èˆŠç‰ˆã€‚</p>
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <div class="flex items-center justify-around">
                            <div class="text-center">
                                <div class="diagram-box server-blue">Blue (v1.0)</div>
                                <div class="mt-2 text-sm">ç·šä¸Šç’°å¢ƒ</div>
                            </div>
                            <div id="bg-arrow" class="traffic-arrow text-blue-500">â†‘</div>
                            <div class="text-center">
                                <div class="diagram-box server-green opacity-50">Green (v1.1)</div>
                                <div class="mt-2 text-sm">é–’ç½®/éƒ¨ç½²ä¸­</div>
                            </div>
                        </div>
                        <div class="text-center my-2">
                            <div class="font-bold">Nginx (åå‘ä»£ç†)</div>
                        </div>
                        <div class="text-center">
                            <button id="switch-traffic-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition-all">æ¨¡æ“¬åˆ‡æ›æµé‡è‡³ Green</button>
                        </div>
                    </div>
                </section>
                <section class="bg-white p-6 rounded-lg shadow-md mb-8">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">å„ªç¼ºé»</h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-semibold text-green-700 mb-2">å„ªé»</h4>
                            <ul class="pro-con-list pro-list relative">
                                <li class="relative mb-2 pl-6"><strong>ç§’ç´šå›æ»¾ï¼š</strong>å‡ºå•é¡Œæ™‚ï¼Œåªéœ€å°‡æµé‡åˆ‡å›èˆŠç’°å¢ƒï¼Œé¢¨éšªæ¥µä½ã€‚</li>
                                <li class="relative mb-2 pl-6"><strong>å……åˆ†æ¸¬è©¦ï¼š</strong>å¯ä»¥åœ¨æ–°ç’°å¢ƒä¸Šç·šå‰é€²è¡Œå®Œæ•´çš„æ•´åˆæ¸¬è©¦ã€‚</li>
                                <li class="relative mb-2 pl-6"><strong>ç’°å¢ƒéš”é›¢ï¼š</strong>æ–°èˆŠç‰ˆæœ¬å®Œå…¨éš”é›¢ï¼Œä¸æœƒäº’ç›¸å½±éŸ¿ã€‚</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold text-red-700 mb-2">ç¼ºé»</h4>
                             <ul class="pro-con-list con-list relative">
                                <li class="relative mb-2 pl-6"><strong>è³‡æºæˆæœ¬é«˜ï¼š</strong>éœ€è¦ç¶­è­·å…©å¥—ç”Ÿç”¢ç’°å¢ƒï¼Œç¡¬é«”æˆæœ¬è¿‘ä¹åŠ å€ã€‚</li>
                                <li class="relative mb-2 pl-6"><strong>è¨­å®šè¼ƒè¤‡é›œï¼š</strong>éœ€è¦é¡å¤–è¨­å®šåå‘ä»£ç†ä¾†ç®¡ç†æµé‡ã€‚</li>
                            </ul>
                        </div>
                    </div>
                </section>
                <section class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">å¯¦ä½œæ­¥é©Ÿèˆ‡ç¨‹å¼ç¢¼</h3>
                    <p class="mb-4 text-gray-700">æˆ‘å€‘éœ€è¦å¼•å…¥ Nginx ä½œç‚ºåå‘ä»£ç†ã€‚éƒ¨ç½²æµç¨‹å°‡æ”¹ç‚ºåœ¨ GitLab CI ä¸­ç·¨å¯«è…³æœ¬ï¼Œå‹•æ…‹åœ°æ›´æ–° Nginx è¨­å®šæª”ä»¥åˆ‡æ›æµé‡ã€‚</p>

                    <h4 class="font-semibold mt-6 mb-2">1. æ–°çš„ `docker-compose.yml`</h4>
                    <p class="mb-2 text-sm text-gray-600">å®šç¾© blueã€green å…©å€‹æœå‹™ä»¥åŠ nginx ä»£ç†ã€‚</p>
                    <div class="relative">
                        <pre><code class="language-yaml">version: '3.8'

services:
  blue:
    build: .
    container_name: eip-ui-blue
    image: eip-ui:blue
    expose:
      - "3000"
    environment:
      - NODE_ENV=production
      - TZ=Asia/Ho_Chi_Minh
      - NEXT_TELEMETRY_DISABLED=1
    restart: always
    networks:
      - eip_network
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3000/api/health"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 20s

  green:
    build: .
    container_name: eip-ui-green
    image: eip-ui:green
    expose:
      - "3000"
    environment:
      - NODE_ENV=production
      - TZ=Asia/Ho_Chi_Minh
      - NEXT_TELEMETRY_DISABLED=1
    restart: always
    networks:
      - eip_network
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3000/api/health"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 20s

  nginx:
    image: nginx:1.25-alpine
    container_name: eip-ui-proxy
    ports:
      - "8888:80"
    volumes:
      - ./nginx:/etc/nginx/conf.d
    depends_on:
      - blue
      - green
    networks:
      - eip_network
    healthcheck:
      test: ["CMD", "nginx", "-t"]
      interval: 10s
      timeout: 5s
      retries: 3

networks:
  eip_network:
    driver: bridge
</code></pre>
                        <button class="copy-btn">è¤‡è£½</button>
                    </div>

                    <h4 class="font-semibold mt-6 mb-2">2. Nginx è¨­å®šæª” (`nginx/default.conf`) (å·²ä¿®æ­£)</h4>
                    <p class="mb-2 text-sm text-gray-600">ç§»é™¤ä½”ä½ç¬¦ï¼Œå°‡ `proxy_pass` é è¨­æŒ‡å‘ `blue_upstream`ï¼Œç¢ºä¿ Nginx ç¸½èƒ½ä»¥æœ‰æ•ˆçš„è¨­å®šå•Ÿå‹•ã€‚</p>
                     <div class="relative">
                        <pre><code class="language-nginx">upstream blue_upstream {
    server blue:3000;
}

upstream green_upstream {
    server green:3000;
}

server {
    listen 80;
    server_name localhost;

    location / {
        proxy_pass http://blue_upstream;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
</code></pre>
                        <button class="copy-btn">è¤‡è£½</button>
                    </div>

                    <h4 class="font-semibold mt-6 mb-2">3. éƒ¨ç½²è…³æœ¬ (`deploy.sh`) (å·²ä¿®æ­£)</h4>
                    <p class="mb-2 text-sm text-gray-600">æ­¤ç‰ˆæœ¬ä¿®æ­£äº† `sed` æŒ‡ä»¤ï¼Œä½¿å…¶èƒ½åœ¨ `blue_upstream` å’Œ `green_upstream` ä¹‹é–“æ­£ç¢ºåˆ‡æ›ã€‚</p>
                     <div class="relative">
                        <pre><code class="language-bash">#!/bin/bash
set -e

# å®šç¾© Nginx è¨­å®šæª”çš„è·¯å¾‘
NGINX_CONFIG_FILE="./nginx/default.conf"

# æª¢æŸ¥ Nginx è¨­å®šæª”æ˜¯å¦å­˜åœ¨
if [ ! -f "$NGINX_CONFIG_FILE" ]; then
    echo "éŒ¯èª¤: Nginx è¨­å®šæª”ä¸å­˜åœ¨æ–¼ $NGINX_CONFIG_FILE"
    exit 1
fi

# æ‰¾å‡ºç•¶å‰æ´»èºçš„ upstream å’Œé–’ç½®çš„é¡è‰²
ACTIVE_UPSTREAM=$(grep "proxy_pass http://" "$NGINX_CONFIG_FILE" | awk -F'//' '{print $2}' | sed 's/;//')

if [ "$ACTIVE_UPSTREAM" == "blue_upstream" ]; then
  INACTIVE_COLOR="green"
  ACTIVE_COLOR="blue"
else
  INACTIVE_COLOR="blue"
  ACTIVE_COLOR="green"
fi

echo "ç•¶å‰æ´»èºæœå‹™: $ACTIVE_COLOR"
echo "å°‡è¦éƒ¨ç½²åˆ°: $INACTIVE_COLOR"

# æ­¥é©Ÿ 1: åªå»ºç«‹æ–°ç‰ˆæœ¬æœå‹™çš„æ˜ åƒæª”
echo "æ­£åœ¨å»ºç«‹æ–°ç‰ˆæœ¬ $INACTIVE_COLOR çš„æ˜ åƒæª”..."
sudo docker compose build $INACTIVE_COLOR

# æ­¥é©Ÿ 2: å•Ÿå‹•æ‰€æœ‰æœå‹™ (Compose æœƒè‡ªå‹•ä½¿ç”¨æ–°çš„æ˜ åƒæª”)
echo "æ­£åœ¨å•Ÿå‹•æ‰€æœ‰æœå‹™..."
sudo docker compose up -d

# ç­‰å¾…æ–°å®¹å™¨å¥åº·æª¢æŸ¥é€šé
echo "ç­‰å¾… $INACTIVE_COLOR æœå‹™å¥åº·..."
while [ "$(sudo docker inspect -f {{.State.Health.Status}} eip-ui-${INACTIVE_COLOR})" != "healthy" ]; do
    echo -n "."
    sleep 3
done
echo ""
echo "$INACTIVE_COLOR æœå‹™å·²æº–å‚™å°±ç·’ï¼"

# ç¢ºä¿ Nginx æœå‹™æ­£åœ¨é‹è¡Œ
echo "æ­£åœ¨æª¢æŸ¥ Nginx æœå‹™ç‹€æ…‹..."
while [ "$(sudo docker inspect -f {{.State.Status}} eip-ui-proxy)" != "running" ]; do
    echo "Nginx å°šæœªé‹è¡Œï¼Œç­‰å¾…ä¸­..."
    sleep 3
done
echo "Nginx æœå‹™å·²é‹è¡Œï¼"

# åˆ‡æ› Nginx æµé‡
echo "æ­£åœ¨åˆ‡æ›æµé‡è‡³ $INACTIVE_COLOR..."
sed -i "s/proxy_pass http:\/\/$ACTIVE_UPSTREAM;/proxy_pass http:\/\/${INACTIVE_COLOR}_upstream;/" "$NGINX_CONFIG_FILE"

# é‡æ–°è¼‰å…¥ Nginx è¨­å®š
sudo docker compose exec nginx nginx -s reload
echo "æµé‡å·²æˆåŠŸåˆ‡æ›ï¼"

# åœæ­¢èˆŠçš„å®¹å™¨ (å¯é¸ï¼Œä¹Ÿå¯ä»¥ä¿ç•™ä½œç‚ºå¿«é€Ÿå›æ»¾)
echo "æ­£åœ¨åœæ­¢èˆŠçš„ $ACTIVE_COLOR æœå‹™..."
sudo docker compose stop $ACTIVE_COLOR

echo "éƒ¨ç½²å®Œæˆï¼"
</code></pre>
                        <button class="copy-btn">è¤‡è£½</button>
                    </div>

                    <h4 class="font-semibold mt-6 mb-2">4. æ›´æ–°å¾Œçš„ `.gitlab-ci.yml`</h4>
                    <p class="mb-2 text-sm text-gray-600">å°‡éƒ¨ç½²éšæ®µçš„ script æ”¹ç‚ºåŸ·è¡Œæˆ‘å€‘çš„ `deploy.sh` è…³æœ¬ã€‚</p>
                     <div class="relative">
                        <pre><code class="language-yaml">stages:
  - deploy
  - notify

deploy:
  stage: deploy
  rules:
    - if: '$CI_COMMIT_BRANCH == "main"'
  tags:
    - docker-prod
  script:
    - echo "é–‹å§‹é›¶åœæ©Ÿéƒ¨ç½²..."
    - cd $CI_PROJECT_DIR
    - chmod +x deploy.sh
    - ./deploy.sh
    - echo "é›¶åœæ©Ÿéƒ¨ç½²å®Œæˆï¼"

# ... notify stages remain the same ...
</code></pre>
                        <button class="copy-btn">è¤‡è£½</button>
                    </div>
                </section>
            </div>

            <!-- Rolling Update Panel -->
            <div id="rolling-update" class="content-panel">
                <section class="bg-white p-6 rounded-lg shadow-md mb-8">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">æ¦‚å¿µèªªæ˜</h3>
                    <p class="mb-4 text-gray-700">æ»¾å‹•æ›´æ–°æ˜¯é€æ­¥ç”¨æ–°ç‰ˆæœ¬å®¹å™¨æ›¿æ›èˆŠç‰ˆæœ¬å®¹å™¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰ 3 å€‹æœå‹™å¯¦ä¾‹ï¼Œæ»¾å‹•æ›´æ–°æœƒå…ˆå•Ÿå‹•ä¸€å€‹ v1.1 çš„æ–°å¯¦ä¾‹ï¼Œå¾…å…¶å¥åº·å¾Œï¼Œå†é—œé–‰ä¸€å€‹ v1.0 çš„èˆŠå¯¦ä¾‹ï¼Œé‡è¤‡æ­¤éç¨‹ç›´åˆ°æ‰€æœ‰å¯¦ä¾‹éƒ½æ›´æ–°ç‚ºæ–°ç‰ˆã€‚Docker Compose æœ¬èº«ä¸ç›´æ¥æ”¯æ´ï¼Œä½†å¯ä»¥é€éè…³æœ¬å’Œ `--scale` åƒæ•¸æ¨¡æ“¬ã€‚</p>
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <div id="rolling-diagram" class="grid grid-cols-4 gap-4 items-center justify-items-center">
                            <div class="diagram-box server-old">v1.0</div>
                            <div class="diagram-box server-old">v1.0</div>
                            <div class="diagram-box server-old">v1.0</div>
                            <div class="text-center">
                                <button id="start-rolling-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition-all">æ¨¡æ“¬æ›´æ–°</button>
                            </div>
                        </div>
                    </div>
                </section>
                 <section class="bg-white p-6 rounded-lg shadow-md mb-8">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">å„ªç¼ºé»</h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-semibold text-green-700 mb-2">å„ªé»</h4>
                            <ul class="pro-con-list pro-list relative">
                                <li class="relative mb-2 pl-6"><strong>è³‡æºæˆæœ¬ä½ï¼š</strong>ä¸éœ€è¦é¡å¤–çš„ä¼ºæœå™¨è³‡æºã€‚</li>
                                <li class="relative mb-2 pl-6"><strong>éƒ¨ç½²éç¨‹å¹³æ»‘ï¼š</strong>æµé‡é€æ­¥è½‰ç§»ï¼Œå°ä½¿ç”¨è€…å½±éŸ¿å°ã€‚</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold text-red-700 mb-2">ç¼ºé»</h4>
                             <ul class="pro-con-list con-list relative">
                                <li class="relative mb-2 pl-6"><strong>å›æ»¾è¤‡é›œï¼š</strong>å›æ»¾éœ€è¦åå‘åŸ·è¡Œæ›´æ–°æµç¨‹ï¼Œæ¯”è—ç¶ éƒ¨ç½²æ…¢ã€‚</li>
                                <li class="relative mb-2 pl-6"><strong>ç‰ˆæœ¬å…±å­˜å•é¡Œï¼š</strong>æ›´æ–°æœŸé–“ï¼Œæ–°èˆŠç‰ˆæœ¬ API å¯èƒ½æœƒåŒæ™‚å­˜åœ¨ï¼Œéœ€ç¢ºä¿å‘ä¸‹ç›¸å®¹ã€‚</li>
                                <li class="relative mb-2 pl-6"><strong>ä¸é©åˆå–®ä¸€å¯¦ä¾‹ï¼š</strong>å¦‚æœåªæœ‰ä¸€å€‹æœå‹™å¯¦ä¾‹ï¼Œæ­¤æ–¹æ³•ç„¡æ•ˆï¼Œä»æœƒé€ æˆåœæ©Ÿã€‚</li>
                            </ul>
                        </div>
                </section>
                <section class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">å¯¦ä½œæ­¥é©Ÿèˆ‡ç¨‹å¼ç¢¼</h3>
                    <p class="mb-4 text-gray-700">æ­¤æ–¹æ¡ˆéœ€è¦æ‚¨çš„æœå‹™èƒ½æ°´å¹³æ“´å±•ï¼ˆé‹è¡Œå¤šå€‹å¯¦ä¾‹ï¼‰ã€‚æˆ‘å€‘å°‡ä½¿ç”¨ Docker Compose çš„ `--scale` å‘½ä»¤å’Œå…§å»ºçš„ `deploy.update_config` ä¾†å¯¦ç¾ã€‚æ³¨æ„ï¼šé€™éœ€è¦åœ¨ Docker Swarm æ¨¡å¼ä¸‹æ‰èƒ½ç²å¾—æœ€ä½³æ•ˆæœï¼Œä½†æˆ‘å€‘å¯ä»¥åœ¨å–®æ©Ÿä¸Šç”¨è…³æœ¬æ¨¡æ“¬ã€‚</p>
                    
                    <h4 class="font-semibold mt-6 mb-2">1. `docker-compose.yml` (åŠ å…¥ replicas å’Œ update_config)</h4>
                    <p class="mb-2 text-sm text-gray-600">ä½¿ç”¨ `deploy` key ä¾†å®šç¾©æ›´æ–°ç­–ç•¥å’Œå‰¯æœ¬æ•¸é‡ã€‚</p>
                    <div class="relative">
                    <pre><code class="language-yaml">version: '3.8'

services:
  eip-ui-v2:
    image: your-repo/eip-ui:${CI_COMMIT_SHORT_SHA} # é¡åƒæ¨™ç±¤æ‡‰è©²æ˜¯å‹•æ…‹çš„
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "80:3000"
    environment:
      - NODE_ENV=production
      - TZ=Asia/Ho_Chi_Minh
      - NEXT_TELEMETRY_DISABLED=1
    networks:
      - EipApps_network
    deploy:
      replicas: 3 # é‹è¡Œ 3 å€‹å¯¦ä¾‹
      update_config:
        parallelism: 1 # ä¸€æ¬¡åªæ›´æ–°ä¸€å€‹å¯¦ä¾‹
        delay: 10s # æ¯å€‹å¯¦ä¾‹æ›´æ–°é–“éš” 10 ç§’
        order: start-first # å…ˆå•Ÿå‹•æ–°å¯¦ä¾‹ï¼Œå†é—œé–‰èˆŠå¯¦ä¾‹
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  EipApps_network:
    external: true
</code></pre>
                        <button class="copy-btn">è¤‡è£½</button>
                    </div>

                    <h4 class="font-semibold mt-6 mb-2">2. æ›´æ–°å¾Œçš„ `.gitlab-ci.yml`</h4>
                    <p class="mb-2 text-sm text-gray-600">éƒ¨ç½²æŒ‡ä»¤æ”¹ç‚º `docker stack deploy`ï¼Œé€™æœƒåˆ©ç”¨ Swarm æ¨¡å¼çš„æ»¾å‹•æ›´æ–°èƒ½åŠ›ã€‚</p>
                    <div class="relative">
                    <pre><code class="language-yaml">stages:
  - build
  - deploy
  - notify

build:
  stage: build
  script:
    - docker build -t your-repo/eip-ui:${CI_COMMIT_SHORT_SHA} .
    - docker push your-repo/eip-ui:${CI_COMMIT_SHORT_SHA} # éœ€è¦æ¨é€åˆ° Docker Registry

deploy:
  stage: deploy
  rules:
    - if: '$CI_COMMIT_BRANCH == "main"'
  tags:
    - docker-prod
  script:
    - echo "åˆå§‹åŒ– Docker Swarm (å¦‚æœå°šæœªåˆå§‹åŒ–)..."
    - docker swarm init --advertise-addr $(hostname -i) || true
    - echo "é–‹å§‹æ»¾å‹•æ›´æ–°éƒ¨ç½²..."
    # ä½¿ç”¨ docker stack deploy ä¾†è§¸ç™¼æ»¾å‹•æ›´æ–°
    - docker stack deploy -c docker-compose.yml eip-stack --with-registry-auth
    - echo "æ»¾å‹•æ›´æ–°éƒ¨ç½²å·²è§¸ç™¼ï¼"

# ... notify stages ...
</code></pre>
                        <button class="copy-btn">è¤‡è£½</button>
                    </div>
                     <div class="mt-4 p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700">
                        <p class="font-bold">é‡è¦æç¤º</p>
                        <p>æ»¾å‹•æ›´æ–°æ–¹æ¡ˆå¼·çƒˆå»ºè­°åœ¨ **Docker Swarm** æ¨¡å¼ä¸‹é‹è¡Œï¼Œå®ƒåŸç”Ÿæ”¯æŒ `deploy` é…ç½®ã€‚å¦‚æœæ‚¨ä¸æƒ³å•Ÿç”¨ Swarmï¼Œå‰‡éœ€è¦ç·¨å¯«æ›´è¤‡é›œçš„ shell è…³æœ¬ä¾†æ‰‹å‹• `docker compose up --scale` å’Œ `stop` èˆŠå®¹å™¨ï¼Œé€™æœƒæ›´ç¹ç‘£ä¸”å®¹æ˜“å‡ºéŒ¯ã€‚</p>
                    </div>
                </section>
            </div>

            <!-- Recommendations Panel -->
            <div id="recommendations" class="content-panel">
                 <section class="bg-white p-6 rounded-lg shadow-md mb-8">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">æ–¹æ¡ˆæ¯”è¼ƒèˆ‡é¸æ“‡å»ºè­°</h3>
                    <p class="mb-4 text-gray-700">é¸æ“‡å“ªç¨®æ–¹æ¡ˆå–æ±ºæ–¼æ‚¨å°è³‡æºæˆæœ¬ã€é¢¨éšªå®¹å¿åº¦å’Œåœ˜éšŠç¶­é‹èƒ½åŠ›çš„æ¬Šè¡¡ã€‚ä»¥ä¸‹æ˜¯å…©å€‹æ–¹æ¡ˆçš„ç›´è§€æ¯”è¼ƒã€‚</p>

                    <div class="grid md:grid-cols-2 gap-8 items-center">
                        <div class="chart-container relative h-[350px] w-full max-w-md mx-auto">
                            <canvas id="strategyChart"></canvas>
                        </div>
                        <div>
                            <table class="w-full text-left border-collapse">
                                <thead>
                                    <tr>
                                        <th class="border-b-2 p-2">è©•ä¼°ç¶­åº¦</th>
                                        <th class="border-b-2 p-2 text-blue-600">è—ç¶ éƒ¨ç½²</th>
                                        <th class="border-b-2 p-2 text-green-600">æ»¾å‹•æ›´æ–°</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-b">
                                        <td class="p-2 font-medium">è³‡æºæˆæœ¬</td>
                                        <td class="p-2">é«˜ (â­ï¸â­ï¸â­ï¸â­ï¸)</td>
                                        <td class="p-2">ä½ (â­ï¸)</td>
                                    </tr>
                                    <tr class="border-b">
                                        <td class="p-2 font-medium">å¯¦ä½œè¤‡é›œåº¦</td>
                                        <td class="p-2">ä¸­ (â­ï¸â­ï¸â­ï¸)</td>
                                        <td class="p-2">ä¸­/é«˜ (â­ï¸â­ï¸â­ï¸â­ï¸)</td>
                                    </tr>
                                    <tr class="border-b">
                                        <td class="p-2 font-medium">å›æ»¾é€Ÿåº¦</td>
                                        <td class="p-2">æ¥µå¿« (â­ï¸)</td>
                                        <td class="p-2">æ…¢ (â­ï¸â­ï¸â­ï¸â­ï¸)</td>
                                    </tr>
                                    <tr class="border-b">
                                        <td class="p-2 font-medium">éƒ¨ç½²é¢¨éšª</td>
                                        <td class="p-2">ä½ (â­ï¸)</td>
                                        <td class="p-2">ä¸­ (â­ï¸â­ï¸â­ï¸)</td>
                                    </tr>
                                </tbody>
                            </table>
                             <p class="text-xs text-gray-500 mt-2">è¨»ï¼šæ˜Ÿè™Ÿè¶Šå¤šä»£è¡¨ç¨‹åº¦è¶Šé«˜ï¼ˆä¾‹å¦‚æˆæœ¬è¶Šé«˜ã€é€Ÿåº¦è¶Šæ…¢ï¼‰ã€‚</p>
                        </div>
                    </div>
                    
                    <div class="mt-8">
                        <h4 class="font-semibold text-lg mb-2">æˆ‘çš„å»ºè­°</h4>
                        <p class="text-gray-700">å°æ–¼å¤§å¤šæ•¸å°‹æ±‚ç©©å®šä¸”é¢¨éšªå¯æ§çš„åœ˜éšŠï¼Œæˆ‘å¼·çƒˆæ¨è–¦å¾**è—ç¶ éƒ¨ç½²**é–‹å§‹ã€‚é›–ç„¶å®ƒéœ€è¦é¡å¤–çš„è³‡æºï¼Œä½†å…¶æ¥µä½çš„éƒ¨ç½²é¢¨éšªå’Œè¿‘ä¹å³æ™‚çš„å›æ»¾èƒ½åŠ›ï¼Œç‚ºç·šä¸Šæœå‹™æä¾›äº†å¼·å¤§çš„å®‰å…¨ä¿éšœã€‚</p>
                        <p class="mt-2 text-gray-700">ç•¶æ‚¨çš„æœå‹™æˆç†Ÿåˆ°éœ€è¦é‹è¡Œå¤§é‡å¯¦ä¾‹ï¼Œä¸¦ä¸”å°æˆæœ¬æ¥µç‚ºæ•æ„Ÿæ™‚ï¼Œå†è€ƒæ…®å¼•å…¥ Docker Swarm æˆ– Kubernetesï¼Œä¸¦æ¡ç”¨æ›´ç²¾ç´°çš„æ»¾å‹•æ›´æ–°æˆ–é‡‘é›€éƒ¨ç½²ç­–ç•¥ã€‚</p>
                    </div>

                </section>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tabs = document.querySelectorAll('.tab-btn');
            const panels = document.querySelectorAll('.content-panel');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    const target = tab.getAttribute('data-tab');
                    panels.forEach(panel => {
                        if (panel.id === target) {
                            panel.classList.add('active');
                        } else {
                            panel.classList.remove('active');
                        }
                    });
                });
            });

            // Copy button functionality
            document.querySelectorAll('.copy-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const pre = button.previousElementSibling;
                    const code = pre.querySelector('code').innerText;
                    
                    // Fallback for environments with restricted clipboard access
                    const textArea = document.createElement('textarea');
                    textArea.value = code;
                    // Make the textarea invisible
                    textArea.style.position = 'fixed';
                    textArea.style.top = '-9999px';
                    textArea.style.left = '-9999px';
                    
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    
                    try {
                        document.execCommand('copy');
                        button.innerText = 'å·²è¤‡è£½!';
                    } catch (err) {
                        console.error('Fallback: Oops, unable to copy', err);
                        button.innerText = 'è¤‡è£½å¤±æ•—';
                    }
                    
                    document.body.removeChild(textArea);

                    setTimeout(() => {
                        button.innerText = 'è¤‡è£½';
                    }, 2000);
                });
            });
            
            // Blue-Green animation
            const switchBtn = document.getElementById('switch-traffic-btn');
            const bgArrow = document.getElementById('bg-arrow');
            const blueServer = document.querySelector('.server-blue');
            const greenServer = document.querySelector('.server-green');
            let isBlueActive = true;

            switchBtn.addEventListener('click', () => {
                if (isBlueActive) {
                    bgArrow.style.transform = 'rotate(180deg)';
                    bgArrow.classList.remove('text-blue-500');
                    bgArrow.classList.add('text-green-500');
                    greenServer.classList.remove('opacity-50');
                    blueServer.classList.add('opacity-50');
                    switchBtn.innerText = 'æ¨¡æ“¬åˆ‡æ›æµé‡è‡³ Blue';
                } else {
                    bgArrow.style.transform = 'rotate(0deg)';
                    bgArrow.classList.add('text-blue-500');
                    bgArrow.classList.remove('text-green-500');
                    blueServer.classList.remove('opacity-50');
                    greenServer.classList.add('opacity-50');
                    switchBtn.innerText = 'æ¨¡æ“¬åˆ‡æ›æµé‡è‡³ Green';
                }
                isBlueActive = !isBlueActive;
            });

            // Rolling update animation
            const startRollingBtn = document.getElementById('start-rolling-btn');
            const rollingDiagram = document.getElementById('rolling-diagram');
            const originalServers = rollingDiagram.innerHTML;

            startRollingBtn.addEventListener('click', () => {
                rollingDiagram.innerHTML = originalServers; // Reset
                const servers = rollingDiagram.querySelectorAll('.diagram-box');
                let i = 0;
                const interval = setInterval(() => {
                    if (i < servers.length) {
                        const server = servers[i];
                        server.classList.remove('server-old');
                        server.classList.add('server-new');
                        server.innerText = 'v1.1';
                        i++;
                    } else {
                        clearInterval(interval);
                    }
                }, 800);
            });


            // Chart.js Radar Chart
            const ctx = document.getElementById('strategyChart').getContext('2d');
            const chartData = {
                labels: ['è³‡æºæˆæœ¬', 'å¯¦ä½œè¤‡é›œåº¦', 'å›æ»¾é€Ÿåº¦', 'éƒ¨ç½²é¢¨éšª'],
                datasets: [{
                    label: 'è—ç¶ éƒ¨ç½²',
                    data: [4, 3, 1, 1],
                    fill: true,
                    backgroundColor: 'rgba(37, 99, 235, 0.2)',
                    borderColor: 'rgb(37, 99, 235)',
                    pointBackgroundColor: 'rgb(37, 99, 235)',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgb(37, 99, 235)'
                }, {
                    label: 'æ»¾å‹•æ›´æ–°',
                    data: [1, 4, 4, 3],
                    fill: true,
                    backgroundColor: 'rgba(22, 163, 74, 0.2)',
                    borderColor: 'rgb(22, 163, 74)',
                    pointBackgroundColor: 'rgb(22, 163, 74)',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgb(22, 163, 74)'
                }]
            };
            new Chart(ctx, {
                type: 'radar',
                data: chartData,
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: {
                                display: true
                            },
                            suggestedMin: 0,
                            suggestedMax: 5,
                            pointLabels: {
                                font: {
                                    size: 14,
                                }
                            },
                             ticks: {
                                backdropColor: 'rgba(0,0,0,0)',
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                             callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.r !== null) {
                                        const mapping = ['æ¥µä½', 'ä½', 'ä¸­', 'é«˜', 'æ¥µé«˜'];
                                        label += mapping[context.parsed.r-1] || context.parsed.r;
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>
